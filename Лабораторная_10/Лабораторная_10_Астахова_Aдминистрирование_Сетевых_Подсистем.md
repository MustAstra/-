**РОССИЙСКИЙ УНИВЕРСИТЕТ ДРУЖБЫ**

> **НАРОДОВ**

**Факультет физико-математических и естественных**

**наук**

**Кафедра теории вероятностей и кибербезопасности**

**Отчет лабораторной работы 10**

**Дисциплина:** Администрирование сетевых подсистем

Студент: Астахова Марина

Группа: НПИбд-02-23

***Тема: Расширенные настройки SMTP-сервера***

***1***

***0.1. Цель работы.***

Приобретение практических навыков по конфигурированию SMTP-

сервера в части настройки аутентификации.

***1***

***0.2. Выполнение работы***

**1**

**0.2.1. Настройка LMTP в Dovecote**

Осуществляю вход на виртуальную машину server под своей учётной

записью пользователя, открываю терминал для выполнения команд, затем

перехожу в режим суперпользователя с помощью команды sudo -i.

Запускаю дополнительный терминал, в котором также активирую режим

суперпользователя и затем после - мониторинг работы почтовой службы в

реальном времени командой tail -f /var/log/maillog для отслеживания
логов

почтового сервера.

Таким образом, подготавливаю среду для дальнейшей настройки и

отладки почтового сервера с одновременным наблюдением за системными

событиями в лог-файле.

Настраиваю в Dovecot сервис lmtp для связи с Postfix.

Переопределяю в Postfix с помощью postconf передачу сообщений не

напрямую, а через заданный Unix-сокет:

Теперь отправляю письмо:

Сообщение получено

**1**

**0.2.2. Настройка SMTP-аутентификации**

В файле /etc/dovecot/conf.d/10-master.conf определяю службу

аутентификации пользователей:

Для Postfix задаем тип аутентификации SASL для smtpd и путь к

соответствующему unix-сокету:

Настраиваю Postfix для приёма почты из Интернета только для

обслуживаемых нашим сервером пользователей или для произвольных

пользователей локальной машины (имеется в виду локальных

пользователей сервера), обеспечивая тем самым запрет на использование

почтового сервера в качестве SMTP relay для спам рассылок (порядок

указания опций имеет значение) и ограничу прием почты:

Для проверки работы аутентификации временно запускаю SMTP-сервер

(порт 25) с возможностью аутентификации. Для этого необходимо в файле

/

etc/postfix/master.cf произвести замену.

На клиенте устанавливаю telnet

На клиенте получаю строку для аутентификации, вместо username указав

логин своего пользователя, а вместо password указываю пароль:

Подключим на клиенте к SMTP-серверу посредством telnet:

Протестируем подключение

**1**

**0.2.3. Настройка SMTP over TLS**

Настраиваю на сервере TLS, воспользовавшись временным

сертификатом Dovecot. Предварительно скопирую необходимые

файлы сертификата и ключа из каталога /etc/pki/dovecot в каталог

/

etc/pki/tls/ в соответствующие подкаталоги:

Сконфигурирую Postfix, указав пути к сертификату и ключу, а

также к каталогу для хранения TLS-сессий и уровень

безопасности:

Заменю в файле строки

Настраиваю межсетевой экран:

Проверю корректность отправки почтовых сообщений с клиента

посредством почтового клиента Evolution, предварительно скорректировав

настройки учётной записи, а именно для SMTP-сервера укажите порт 587,

STARTTLS и обычный пароль.

**1**

**0.2.4. Внесение изменений в настройки внутреннего**

**окружения виртуальной машины**

Помещаю конфигурационные файлы в каталог и вношу изменения в

vagrant и создаем файл mail.sh

***1***

***0.3. Итог работы***

В результате была обеспечена безопасная работа SMTP-сервера,

исключающая возможность несанкционированного использования в

качестве открытого ретранслятора (open relay). Были закреплены знания о

принципах работы SMTP-протокола, механизмах SASL и методах защиты

почтового трафика.

***1***

***0.4 Контрольные вопросы***

**1**

**. Пример задания формата аутентификации пользователя в**

**Dovecot в форме логина с указанием домена**

В Dovecot формат логина с указанием домена можно настроить через

параметр auth_username_format.

Пример настройки в конфигурационном файле Dovecot:

auth_username_format = %n@%d

Где:

•

•

%n --- имя пользователя (без домена).

%d --- доменная часть (домен).

Это означает, что при аутентификации пользователь должен вводить

логин в формат[е](mailto:username@example.com)
[[username@example.com]{.underline},](mailto:username@example.com) даже
если домен явно не указан

в системном имени пользователя.

Также можно настроить автоматическое добавление домена, если

пользователь вводит только логин без домена:

auth_username_format =
[[%n@example.com](mailto:%25n@example.com)]{.underline}

В этом случае, если пользователь введёт user1, Dovecot преобразует это в

[[user1@example.com]{.underline}.](mailto:user1@example.com)

**2**

**. Функции почтового Relay-сервера**

Почтовый Relay-сервер выполняет следующие функции:

•

**Пересылка почты между серверами** --- принимает почту от

отправителей (клиентов или других серверов) и передаёт её

конечным получателям или следующим серверам в цепочке

доставки.

•

•

•

**Маршрутизация писем** --- определяет оптимальный путь доставки

почты на основе DNS-записей (MX-записи) и конфигурации.

**Контроль доступа** --- разрешает или запрещает ретрансляцию

почты на основе правил (например, по IP-адресу, аутентификации).

**Обработка очереди сообщений** --- временное хранение писем в

случае недоступности сервера получателя с последующими

попытками повторной отправки.

•

•

•

**Фильтрация трафика** --- применение антиспамовых и

антивирусных правил для входящих и исходящих сообщений.

**Балансировка нагрузки** --- распределение почтового трафика

между несколькими серверами для повышения надёжности.

**Анонимизация источника** --- скрытие внутренней структуры сети

корпоративных почтовых серверов при отправке писем во внешние

сети.

**3**

**. Угрозы безопасности при настройке почтового сервера как**

**Relay сервера**

Если Relay-сервер настроен без ограничений (open relay), это может

привести к следующим угрозам:

•

Рассылка спама --- злоумышленники могут использовать открытый

ретранслятор для массовой отправки спама, что приведёт к:

▪

▪

▪

Попаданию IP-адреса сервера в чёрные списки (RBL).

Блокировке доставки легитимной почты.

Репутационным и финансовым потерям.

•

Утечка конфиденциальной информации --- злоумышленники могут

пересылать через сервер письма с внутренней информацией, если не

настроена фильтрация контента.

**Увеличение нагрузки на сервер** --- массовая отправка спама может

вызвать высокую нагрузку на процессор, память и сетевой канал, приводя

к отказам в обслуживании.

**Использование для фишинговых атак** --- открытый ретранслятор может

быть использован для рассылки писем с вредоносными ссылками или

поддельными уведомлениями.

**Сокрытие источника атак** --- злоумышленники маскируют реальный

источник рассылки, используя ваш сервер как прокси.

**Нарушение законодательства** --- рассылка спама или вредоносных писем

через ваш сервер может привести к юридической ответственности.

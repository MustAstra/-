**РОССИЙСКИЙ УНИВЕРСИТЕТ ДРУЖБЫ**

> **НАРОДОВ**

**Факультет физико-математических и естественных**

**наук**

**Кафедра теории вероятностей и кибербезопасности**

**Отчет лабораторной работы 8**

**Дисциплина:** Администрирование сетевых подсистем

Студент: Астахова Марина

Группа: НПИбд-02-23

***Тема:*** Настройка SMTP-сервера

***8***

***.1. Цель работы.***

Приобретение практических навыков по установке и конфигурированию

SMTP сервера.

***8***

***.2. Выполнение работы***

***1***

***. Установите на виртуальной машине server SMTP-сервер***

***postfix. Установка Postfix.***

***Установим необходимые пакеты***

*Sudo apt-get -y install postfix*

*Sudo apt-get -y install postfix*

*Sudo*

*apt-get -y install s-nail*

Сконфигурируем межсетевой экран, разрешив работать службе протокола

SMTP:

Восстановим контекст безопасности в SELinux и запустим postfix:

***2***

***. Сделайте первоначальную настройку postfix при помощи***

***утилиты postconf, задав отправку писем не на локальный***

***хост, а на сервер в домене. Изменение параметров Postfix с***

***помощью postconf.***

Первоначальная настройка Postfix через postconf.

Перезагружаем конфигурацию Postfix:

***3***

***. Проверьте отправку почты с сервера и клиента. Проверка***

***работы Postfix.***

На сервере под учётной записью пользователя отправляем себе письмо,

используя утилиту mail:

На клиенте устанавливаем необходимые для работы пакеты:

Отключим IPv6 в списке разрешённых в работе Postfix протоколов и

оставим только IPv4:

На клиенте запустим Postfix, добавим адрес внутренней сети и

перезагрузим конфигурацию:

***4***

***. Сконфигурируйте Postfix для работы в домене. Проверьте***

***отправку почты с сервера и клиента.Конфигурация Postfix***

***для домена***

Запустим мониторинг работы почтовой службы и посмотрим, что

произошло с вашим сообщением:

Видно, что появилось новое сообщение

Для настройки возможности отправки сообщений не на конкретный узел

сети, а на доменный адрес пропишем MX-запись с указанием имени

почтового сервера mail.astakhovamd.net в файле прямой DNS-зоны:

и в файле обратной DNS-зоны:

В конфигурации Postfix добавим домен в список элементов сети, для

которых данный сервер является конечной точкой доставки почты:

Восстановили контекст безопасности в SELinux и перезапустили DNS.

Отправляем сообщение:

***5***

***. Напишите скрипт для Vagrant, фиксирующий действия по***

***установке и настройке Postfix во внутреннем окружении***

***виртуальной машины server. Соответствующим образом***

***внесите изменения в Vagrantfile. Внесение изменений в***

***настройки внутреннего окружения виртуальной машины.***

На виртуальной машине server перейдем в каталог для внесения

изменений в настройки внутреннего окружения /vagrant/provision/server/.

Заменим конфигурационные файлы DNS-сервера:

Создадим файл mail.sh

Открыв его на редактирование, пропишем в нём следующий

скрипт:

На виртуальной машине client перейдем в каталог для внесения изменений

в настройки внутреннего окружения /vagrant/provision/client/ и напишем

следующий скрипт:

Изменения в vagrantfile:

***8***

***.3. Итог работы***

В ходе выполнения лабораторной работы были приобретены практические

навыки по установке и конфигурированию SMTP сервера.

***8***

***.4. Контрольные вопросы***

***1***

***. В каком каталоге и в каком файле следует смотреть***

***конфигурацию Postfix?***

Основная конфигурация Postfix хранится в каталоге /etc/postfix/.

Два наиболее важных файла конфигурации:

***•***

***main.cf:*** Это основной конфигурационный файл, содержащий

глобальные параметры Postfix, такие как имя хоста, домены, сетевые

интерфейсы, настройки ретрансляции, параметры безопасности и многое

другое.

***•***

***master.cf:*** Этот файл определяет, какие службы Postfix доступны,
как

они запускаются и какие параметры командной строки им передаются. Он

описывает архитектуру Postfix, состоящую из множества небольших

программ.

***2***

***. Каким образом можно проверить корректность***

***синтаксиса в конфигурационном файле Postfix?***

Для проверки корректности синтаксиса конфигурационных файлов Postfix

можно использовать команду postfix check. Эта команда сканирует main.cf

и master.cf на наличие синтаксических ошибок и предупреждений, не

перезапуская и не останавливая службу.

***3***

***. В каких параметрах конфигурации Postfix требуется***

***внести изменения в значениях для настройки возможности***

***отправки писем не на локальный хост, а на доменные адреса?***

По умолчанию Postfix настроен для обработки почты для локальных

пользователей. Чтобы отправлять почту на внешние доменные адреса,

обычно требуется проверить и, возможно, изменить следующие

параметры в файле /etc/postfix/main.cf:

**1**

**. mydestination:**

Этот параметр определяет, для каких доменов Postfix считает себя

конечным получателем. Если домен получателя не указан в mydestination,

Postfix будет пытаться ретранслировать (переслать) письмо.

•

Что изменить: Убедитесь, что mydestination содержит только те

домены, для которых ваш Postfix является конечным почтовым сервером

(т.е. он хранит почтовые ящики для этих доменов). Обычно это

localhost.\$mydomain, \$mydomain, localhost. Если вы хотите, чтобы
Postfix

отправлял письма на внешние домены, убедитесь, что эти внешние

домены не перечислены в mydestination.

**2**

**. mynetworks:**

Этот параметр определяет список доверенных сетей и IP-адресов, с

которых Postfix разрешает ретрансляцию почты без аутентификации. Если

ваш почтовый клиент или другое приложение отправляет почту через этот

Postfix, оно должно находиться в одной из этих сетей или использовать

аутентификацию.

•

Что изменить: Убедитесь, что IP-адреса ваших внутренних клиентов или

серверов, которые будут отправлять почту, включены в mynetworks.

**3**

**. relayhost:**

Если ваш сервер не имеет прямого доступа к интернету для отправки

почты (например, из-за блокировки порта 25 вашим провайдером) или вы

хотите, чтобы вся исходящая почта проходила через другой SMTP-сервер

(например, SMTP-сервер вашего провайдера, Gmail, SendGrid и т.д.), вам

нужно настроить relayhost.

•

Что изменить: Укажите адрес внешнего SMTP-сервера.

***4***

***. Приведите примеры работы с утилитой mail по отправке***

***письма, просмотру имеющихся писем, удалению письма.***

Утилита mail (часто это симлинк на mailx или s-nail) - это простой

консольный почтовый клиент.

**1**

**. Отправка письма:**

a\.

> echo \"Это тело моего письма.\" \| mail -s \"Тема письма\"
>
> [<user@example.com>]{.underline}

b\. echo \"Привет, это письмо от меня.\" \| mail -s \"Приветствие\" -r

> My Nam[e](mailto:my_email@my_domain.com)
> [\<[my_email@my_domain.com]{.underline}\>](mailto:my_email@my_domain.com)\"

\"

[<recipient@example.com>]{.underline}

c\.

mail -s \"Отчет за сегодня[\"](mailto:recipient@example.com)
[[recipient@example.com]{.underline}](mailto:recipient@example.com) \<

/

path/to/report.txt

d\.

mail [<recipient@example.com>]{.underline}

**2**

**3**

**. Просмотр имеющихся писем:**

> a\. Mail p

**. Удаление письма:**

> a\. Mail & d 1

***5***

***. Приведите примеры работы с утилитой postqueue. Как***

***посмотреть очередь сообщений? Как определить число***

***сообщений в очереди? Как отправить все сообщения,***

***находящиеся в очереди? Как удалить письмо из очереди?***

postqueue - это утилита для просмотра и управления очередью сообщений

Postfix.

1

2

. **Как посмотреть очередь сообщений?** Опция -p (print): sudo

> postqueue --p, sudo mailq

. **Как определить число сообщений в очереди?** Самый простой

> способ - посмотреть последнюю строку вывода postqueue -p, которая
>
> обычно содержит суммарную информацию: sudo postqueue -p \| tail -n
>
> 1

3

4

. **Как отправить все сообщения, находящиеся в очереди?** Для

> принудительной попытки доставки всех сообщений в очереди
>
> используйте опцию -f (flush): sudo postqueue -f

. **Как удалить письмо из очереди?** Для удаления письма из очереди

> используется утилита postsuper, а не postqueue. Вам понадобится ID
>
> сообщения, который вы можете получить из postqueue -p. Удаление

конкретного письма:

sudo postsuper -d \<Queue ID\>

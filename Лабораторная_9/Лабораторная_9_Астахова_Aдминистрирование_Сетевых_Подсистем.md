**РОССИЙСКИЙ УНИВЕРСИТЕТ ДРУЖБЫ**

> **НАРОДОВ**

**Факультет физико-математических и естественных**

**наук**

**Кафедра теории вероятностей и кибербезопасности**

**Отчет лабораторной работы 9**

**Дисциплина:** Администрирование сетевых подсистем

Студент: Астахова Марина

Группа: НПИбд-02-23

***Тема:*** Настройка POP3/IMAP сервера

***9***

***.1. Цель работы.***

Приобретение практических навыков по установке и простейшему

конфигурированию POP3/IMAP-сервера.

***9***

***.2. Выполнение работы***

***1***

***. Установите на виртуальной машине server Dovecot и Telnet***

***для дальнейшей проверки корректности работы почтового***

***сервера. Установка Dovecot.***

Установим необходимые для работы пакеты:

***2***

***. Настройте Dovecot. Настройка dovecot.***

В конфигурационном файле /etc/dovecot/dovecot.conf пропишем список

почтовых протоколов, по которым разрешено работать Dovecot:

В конфигурационном файле /etc/dovecot/conf.d/10-auth.conf проверим, что

указан метод аутентификации plain:

В конфигурационном файле /etc/dovecot/conf.d/auth-system.conf.ext

проверим, что для поиска пользователей и их паролей используется pam и

файл passwd:

В конфигурационном файле /etc/dovecot/conf.d/10-mail.conf настроим

месторасположение почтовых ящиков пользователей:

В Postfix задаем каталог для доставки почты:

Сконфигурируем межсетевой экран, разрешив работать службам

протоколов POP3 и IMAP:

Перезапустим Postfix и запустим Dovecot:

***3***

***. Установите на виртуальной машине client программу для***

***чтения почты Evolution и настройте её для манипуляций с***

***почтой вашего пользователя. Проверьте корректность***

***работы почтового сервера как с виртуальной машины server,***

***так и с виртуальной машины client. Проверка работы Dovecot.***

Установим почтовый клиент:

Установим на клиенте пакет evolution:

Запускаем evolution, чтобы настроить почту

Настройка для получения и отправления письма:

Проверка отправки письма через evolution:

Настройка логина и пароля и проверка наличия сообщений:

4

. ***Измените скрипт для Vagrant, фиксирующий действия по***

***установке и настройке Postfix и Dovecote во внутреннем***

***окружении виртуальной машины server, создайте скрипт для***

***Vagrant, фиксирующий действия по установке Evolution во***

***внутреннем окружении виртуальной машины client.***

***Соответствующим образом внесите изменения в Vagrantfile***

***.***

***Внесение изменений в настройки внутреннего окружения***

***виртуальной машины.***

На виртуальной машине server перейдем в каталог для внесения

изменений в настройки внутреннего окружения /vagrant/provision/server/.
В

соответствующие подкаталоги поместите конфигурационные файлы

Dovecot:

Внесем изменения в файл /vagrant/provision/server/mail.sh, добавив в
него

строки:

***9***

***.3. Итоги работы***

Были приобретены практические навыки по установке и простейшему

конфигурированию POP3/IMAP-сервера.

***9***

***.4. Контрольные вопросы***

***1***

***. За что отвечает протокол SMTP?***

SMTP (Simple Mail Transfer Protocol) --- это протокол передачи

электронной почты. Он отвечает за:

•

Отправку почты от клиента к почтовому серверу (MTA - Mail Transfer

Agent): Когда вы нажимаете \"Отправить\" в вашем почтовом клиенте, он

использует SMTP для передачи письма на ваш исходящий почтовый

сервер.

•

Передачу почты между почтовыми серверами: Почтовые серверы

используют SMTP для обмена письмами друг с другом. Например, если вы

отправляете письмо с Gmail на Outlook, сервер Gmail использует SMTP

для связи с сервером Outlook и передачи письма.

•

Доставку почты на конечный почтовый сервер получателя: После того

как письмо прошло через несколько промежуточных серверов, оно в

конечном итоге доставляется на почтовый сервер, обслуживающий домен

получателя.

Ключевые особенности:

•

Порты:

•

25: Стандартный порт для передачи почты между серверами. Часто

блокируется провайдерами для исходящих соединений из домашних сетей

для борьбы со спамом.

•

587: Порт для отправки почты клиентами (submission port). Обычно

используется с TLS/SSL для шифрования.

•

465: Устаревший, но иногда используемый порт для SMTPS (SMTP

over SSL/TLS).

•

Однонаправленный: SMTP предназначен только для отправки. Для

получения и управления почтой используются другие протоколы (IMAP,

POP3).

***2***

***. За что отвечает протокол IMAP?***

IMAP (Internet Message Access Protocol) --- это протокол доступа к

электронной почте, который позволяет почтовому клиенту получать

доступ к письмам, хранящимся на почтовом сервере.

Основные функции и отличия от POP3:

•

Хранение писем на сервере: Письма остаются на сервере, а клиент лишь

синхронизирует их копии или отображает содержимое. Это позволяет

получать доступ к одной и той же почте с разных устройств (компьютер,

телефон, планшет), при этом все изменения (прочтение, удаление,

перемещение) будут синхронизированы.

•

Управление папками: IMAP позволяет создавать, удалять и перемещать

папки (почтовые ящики) на сервере.

•

Флаги сообщений: Поддерживает флаги сообщений (прочитано/не

прочитано, помечено/не помечено, отвечено, переслано и т.д.), которые

также хранятся на сервере.

•

Выборочная загрузка: Клиент может загружать только заголовки писем,

а затем по запросу загружать полное содержимое или вложения. Это

экономит трафик и ускоряет работу.

•

Поиск на сервере: Некоторые реализации IMAP позволяют выполнять

поиск по письмам непосредственно на сервере.

***3***

***. За что отвечает протокол POP3?***

POP3 (Post Office Protocol version 3) --- это протокол доступа к

электронной почте, который позволяет почтовому клиенту загружать

письма с почтового сервера на локальное устройство.

Основные функции и отличия от IMAP:

•

Загрузка и удаление: По умолчанию POP3 загружает все новые письма с

сервера на локальное устройство и удаляет их с сервера. Хотя

большинство современных клиентов позволяют настроить сохранение

копий на сервере, это не является его основной парадигмой.

•

Локальное хранение: После загрузки письма хранятся на локальном

устройстве клиента.

•

Одиночный доступ: POP3 лучше подходит для сценариев, когда к

почтовому ящику обращается только одно устройство, так как после

загрузки письма могут быть недоступны для других клиентов.

•

Простота: POP3 является более простым протоколом по сравнению с

IMAP.

***4***

***. В чём назначение Dovecot?***

Dovecot --- это свободный и открытый сервер IMAP и POP3 для систем на

базе Linux/Unix. Его основное назначение --- предоставление доступа

пользователям к их почтовым ящикам, хранящимся на сервере, с

использованием протоколов IMAP и POP3.

Ключевые функции Dovecot:

•

Сервер IMAP/POP3: Реализует функциональность протоколов IMAP и

POP3, позволяя почтовым клиентам (Outlook, Thunderbird, мобильные

приложения) подключаться и управлять почтой.

•

Хранение почты: Поддерживает различные форматы хранения почты,

наиболее распространенные из которых:

•

Maildir: Каждое письмо хранится в отдельном файле, а каждое

состояние (новое, прочитанное, удаленное) --- в отдельной поддиректории.

Это более надежный и производительный формат.

•

Mbox: Все письма в одной папке хранятся в одном файле.

•

Аутентификация пользователей: Предоставляет гибкие механизмы

аутентификации, позволяя проверять учетные данные пользователей через

различные источники (файлы /etc/passwd, /etc/shadow, SQL-базы данных,

LDAP, PAM и т.д.).

•

Авторизация: Определяет, к каким почтовым ящикам и с какими

правами пользователь имеет доступ.

•

TLS/SSL шифрование: Обеспечивает безопасное соединение между

почтовым клиентом и сервером с использованием TLS/SSL.

***5***

***. В каких файлах обычно находятся настройки работы***

***Dovecot? За что отвечает каждый из файлов?***

Настройки Dovecot обычно находятся в директории /etc/dovecot/.

Современные версии Dovecot используют модульную структуру

конфигурации, где основной файл dovecot.conf импортирует файлы из

поддиректории conf.d/.

Основные файлы конфигурации и их назначение:

1

. **/etc/dovecot/dovecot.conf:**

> a\. Назначение: Главный файл конфигурации. Он обычно
>
> содержит минимальные настройки и, самое главное,
>
> директиву !include_try conf.d/\*.conf, которая включает все
>
> остальные файлы из директории conf.d/. Это позволяет легко
>
> организовывать настройки по категориям.

**. /etc/dovecot/conf.d/10-master.conf:**

**2**

a\. Назначение: Определяет основные сервисы Dovecot и их

> порты.

b\. Примеры настроек:

> i\. service imap { \... }: Настройки IMAP-сервиса (порты,

протоколы).

> ii\. service pop3 { \... }: Настройки POP3-сервиса (порты,
>
> протоколы).

iii\. service auth { \... }: Настройки сервиса аутентификации

> (сокеты, права доступа).

iv\. service lda { \... }: Настройки Local Delivery Agent (LDA),

> используемого Postfix для доставки почты.

**3**

**. /etc/dovecot/conf.d/10-auth.conf**

a\. Назначение: Определяет методы и механизмы аутентификации

> пользователей.

b\. Примеры настроек:

> i\. auth_mechanisms = plain login: Какие методы
>
> аутентификации разрешены.
>
> ii\. auth_username_format = %n: Формат имени пользователя.

iii\. !include auth-system.conf.ext: Включает файл для

> системной аутентификации (например, через

/

etc/passwd).

iv\. !include auth-sql.conf.ext: Включает файл для

> аутентификации через SQL.
>
> v\. !include auth-ldap.conf.ext: Включает файл для
>
> аутентификации через LDAP.

**•**

**Интеграция с MTA:** Тесно интегрируется с MTA (например, Postfix)

для локальной доставки почты в почтовые ящики пользователей. Postfix

передает входящие письма Dovecot, который затем помещает их в

соответствующий почтовый ящик.

**•**

**Плагины:** Поддерживает множество плагинов для расширения

функциональности (например, для квот, полнотекстового поиска,

фильтрации спама).

***6***

***. В чем назначение postfix***

Postfix --- это свободный и открытый MTA (Mail Transfer Agent), то есть

почтовый агент передачи. Его основное назначение --- передача,

маршрутизация и доставка электронной почты. Postfix является заменой

для более старого и сложного Sendmail.

Ключевые функции Postfix:

> Прием почты: Получает входящие письма от других почтовых серверов

•

(через SMTP) или от локальных почтовых клиентов (через SMTP

submission).

•

Отправка почты: Отправляет исходящие письма на другие почтовые

серверы (через SMTP).

•

Маршрутизация почты: Определяет, куда должно быть отправлено

письмо. Для внешних доменов он использует DNS (MX-записи), для

локальных пользователей --- доставляет письмо в их почтовые ящики.

•

Локальная доставка: Для писем, предназначенных локальным

пользователям сервера, Postfix использует Local Delivery Agent (LDA).
Это

может быть встроенный LDA Postfix или внешний LDA, такой как

Dovecot\'s LDA.

•

Очереди сообщений: Хранит письма в очередях, если их не удалось

доставить сразу (например, из-за недоступности сервера получателя).

Повторяет попытки доставки через определенные интервалы.

•

Безопасность: Поддерживает TLS/SSL для шифрования соединений, а

также различные механизмы аутентификации (SASL) для клиентов.

•

Фильтрация спама и вирусов: Легко интегрируется с внешними

фильтрами спама (например, SpamAssassin) и антивирусными сканерами

(например, ClamAV) для обработки входящей и исходящей почты.

•

Виртуальные домены и пользователи: Позволяет обслуживать несколько

доменов на одном сервере и управлять виртуальными пользователями

(которые не имеют системных учетных записей).

В целом, Postfix является центральным узлом в почтовой системе, который

обрабатывает всю логику передачи и доставки писем.

***7***

***. Какие методы аутентификации пользователей можно***

***использовать в Dovecot и в чём их отличие?***

Dovecot поддерживает множество методов (механизмов) аутентификации,

а также различные бэкенды для хранения учетных данных.

1

2

3

. PLAIN:

> a\. Отличие: Имя пользователя и пароль передаются в открытом

(plain text) виде.

b\. Безопасность: Крайне небезопасен без шифрования TLS/SSL.

> Должен использоваться только в защищенных TLS-
>
> соединениях.

. LOGIN:

a\. Отличие: Имя пользователя и пароль передаются отдельно, но

> также в открытом виде (base64-кодированные, но легко
>
> декодируемые).

b\. Безопасность: Аналогично PLAIN, небезопасен без TLS/SSL.

. CRAM-MD5 (Challenge-Response Authentication Mechanism-MD5):

> a\. Отличие: Пароль никогда не передается по сети. Сервер
>
> отправляет клиенту \"вызов\" (challenge), клиент вычисляет хеш
>
> от пароля и вызова с использованием MD5 и отправляет
>
> результат обратно. Сервер выполняет то же самое и
>
> сравнивает результаты.
>
> b\. Безопасность: Более безопасен, чем PLAIN или LOGIN, так
>
> как пароль не передается. Однако MD5 считается устаревшим
>
> и уязвимым для коллизий, а также этот метод уязвим для атак
>
> по словарю, если хеши паролей известны атакующему.

. DIGEST-MD5:

4

a\. Отличие: Более сложный и безопасный вариант CRAM-MD5.

> Использует nonce (случайное число), поддерживает взаимную
>
> аутентификацию (клиент может аутентифицировать сервер),
>
> может быть использован для защиты целостности данных.

b\. Безопасность: Считается более безопасным, чем CRAM-MD5,

> но все еще использует MD5.

***8***

***. Приведите пример заголовка письма с пояснениями его***

***полей.***

Заголовок письма содержит метаданные о сообщении. Вот пример

типичного заголовка и пояснения к его полям:

Received: from mail.example.com (mail.example.com \[192.0.2.1\]) by

mx.recipient.org (Postfix) with ESMTPS id ABCDEF12345 for

[[recipient@recipient.org]{.underline};](mailto:recipient@recipient.org)
Mon, 15 Jan 2024 10:30:00 +0300 (MSK) Received:

from client.sender.com (client.sender.com \[198.51.100.10\]) by

mail.example.com (Postfix) with ESMTPSA id ZYXWVU98765 for

[[recipient@recipient.org]{.underline};](mailto:recipient@recipient.org)
Mon, 15 Jan 2024 10:29:50 +0300 (MSK) From:

Sender Nam[e](mailto:sender@example.com)
[[sender@example.com]{.underline}](mailto:sender@example.com) To:
Recipient Name

[[recipient@recipient.org]{.underline}](mailto:recipient@recipient.org)
Subject: Тестовое письмо с пояснениями заголовков

Date: Mon, 15 Jan 2024 10:29:45 +0300 Message-ID:

[[1](mailto:1234567890.abcdef@example.com)]{.underline}

[[234567890.abcdef@example.com]{.underline}](mailto:1234567890.abcdef@example.com)
MIME-Version: 1.0 Content-Type:

text/plain; charset=\"UTF-8\" Content-Transfer-Encoding: 7bit
User-Agent:

Mozilla Thunderbird 115.6.0 X-Mailer: Mozilla Thunderbird 115.6.0
X-Spam-

Status: No, score=-1.9 required=5.0

tests=ALL_TRUSTED,DKIM_SIGNED,DKIM_VALID,SPF_PASS X-Spam-

Flag: NO

***9***

***. Приведите примеры использования команд для работы с***

***почтовыми протоколами через терминал (например через***

***telnet).***

**1**

**. SMTP (отправка письма)**

***a.*** Порт 25 (без шифрования) или 587 (с шифрованием, но telnet

> не поддерживает TLS). Для порта 587 лучше использовать
>
> openssl s_client. ***telnet smtp.example.com 25***

**2**

**. IMAP (доступ к почте)**

> Порт 143 (без шифрования). Для порта 993 (IMAPS)

используйте openssl s_client. **telnet imap.example.com 143**

**3**

**. POP3 (доступ к почте)**

**a. telnet pop3.example.com 110**

***1***

***0. Приведите примеры с пояснениями по работе с doveadm***

doveadm --- это мощный инструмент командной строки для

администрирования Dovecot. Он позволяет управлять пользователями,

почтовыми ящиками, проверять конфигурацию, просматривать логи и

выполнять другие административные задачи.

Для большинства команд doveadm требуется быть суперпользователем

(root) или иметь соответствующие права.

**1**

**. Проверка аутентификации пользователя:**

*a. doveadm auth test*
[*[user@example.com]{.underline}*](mailto:user@example.com) *password*

**2**

**. Получение информации о пользователе:**

a\. doveadm user [<user@example.com>]{.underline}

**3**

**4**

**5**

**. Просмотр списка почтовых ящиков (папок) пользователя:**

> a\. doveadm mailbox list -[u](mailto:user@example.com)
> [<user@example.com>]{.underline}

**. Создание новой папки (почтового ящика) для пользователя:**

> a\. doveadm mailbox create -[u](mailto:user@example.com)
> [[user@example.com]{.underline}](mailto:user@example.com) \"New
> Folder\"

**. Удаление папки для пользователя:**

a\. doveadm mailbox delete -[u](mailto:user@example.com)
[[user@example.com]{.underline}](mailto:user@example.com) \"Old Folder\"
